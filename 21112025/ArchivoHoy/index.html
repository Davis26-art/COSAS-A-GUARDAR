<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cl칤nica Veterinaria PetCare</title>

<!-- BOOTSTRAP -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
    body { background: #f4f6f7; }
    .pointer { cursor: pointer; }
</style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">游 PetCare</a>
    <div class="d-flex">
      <button class="btn btn-light me-2" onclick="showLogin()">Login</button>
      <button class="btn btn-warning" onclick="showRegister()">Registro</button>
    </div>
  </div>
</nav>

<!-- CONTENIDO GENERAL -->
<div class="container mt-4">

    <!-- LOGIN -->
    <div id="loginSection" class="card p-4" style="display:none;">
        <h3>Iniciar Sesi칩n</h3>
        <input id="loginEmail" class="form-control my-2" placeholder="Correo">
        <input id="loginPass" type="password" class="form-control my-2" placeholder="Contrase침a">
        <button class="btn btn-primary w-100" onclick="login()">Entrar</button>
    </div>

    <!-- REGISTRO -->
    <div id="registerSection" class="card p-4" style="display:none;">
        <h3>Registro</h3>
        <input id="regEmail" class="form-control my-2" placeholder="Correo">
        <input id="regPass" type="password" class="form-control my-2" placeholder="Contrase침a">
        <button class="btn btn-success w-100" onclick="register()">Registrar</button>
    </div>

    <!-- PANEL USUARIO -->
    <div id="panel" style="display:none;">

        <div class="d-flex justify-content-between align-items-center">
            <h2>Mis Mascotas</h2>
            <button class="btn btn-success" onclick="openNewPetModal()">+ Agregar Mascota</button>
        </div>

        <div id="petList" class="mt-3"></div>
    </div>

</div>

<!-- MODAL NUEVA MASCOTA -->
<div class="modal fade" id="newPetModal">
  <div class="modal-dialog">
    <div class="modal-content p-3">
      <h4>Nueva Mascota</h4>
      <input id="petName" class="form-control my-2" placeholder="Nombre">
      <input id="petType" class="form-control my-2" placeholder="Tipo (Perro, Gato)">
      <button class="btn btn-primary" onclick="savePet()">Guardar</button>
    </div>
  </div>
</div>

<!-- MODAL DETALLES DE MASCOTA -->
<div class="modal fade" id="petInfoModal">
  <div class="modal-dialog">
    <div class="modal-content p-3">
      <h4 id="petInfoTitle"></h4>
      <h6 class="text-muted" id="petInfoType"></h6>

      <hr>

      <h5>Historial M칠dico</h5>
      <ul id="petHistory" class="list-group mb-3"></ul>

      <textarea id="newHistory" class="form-control mb-2" placeholder="Agregar nota al historial"></textarea>
      <button class="btn btn-secondary" onclick="addHistory()">Guardar en historial</button>

      <hr>

      <h5>Agendar</h5>
      <button class="btn btn-warning my-1" onclick="schedule('vacuna')">Vacuna</button>
      <button class="btn btn-info my-1" onclick="schedule('consulta')">Consulta</button>
    </div>
  </div>
</div>

<!-- BOOTSTRAP JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
/*===============================
    BASE DE DATOS LOCAL
================================*/
let currentUser = null;
let selectedPetIndex = null;

function loadUsers() {
    return JSON.parse(localStorage.getItem("users") || "{}");
}
function saveUsers(users) {
    localStorage.setItem("users", JSON.stringify(users));
}

/*=====================================
    MOSTRAR SECCIONES
======================================*/
function showLogin() {
    document.getElementById("loginSection").style.display="block";
    document.getElementById("registerSection").style.display="none";
}
function showRegister() {
    document.getElementById("loginSection").style.display="none";
    document.getElementById("registerSection").style.display="block";
}

/*===============================
    REGISTRO
================================*/
function register() {
    let email = document.getElementById("regEmail").value;
    let pass = document.getElementById("regPass").value;

    let users = loadUsers();

    if(users[email]) {
        alert("Este correo ya est치 registrado");
        return;
    }

    users[email] = { password: pass, pets: [] };
    saveUsers(users);

    alert("Usuario registrado. Ahora inicia sesi칩n.");
    showLogin();
}

/*===============================
    LOGIN
================================*/
function login() {
    let email = document.getElementById("loginEmail").value;
    let pass = document.getElementById("loginPass").value;

    let users = loadUsers();

    if(!users[email] || users[email].password !== pass) {
        alert("Datos incorrectos");
        return;
    }

    currentUser = email;
    document.getElementById("panel").style.display = "block";
    document.getElementById("loginSection").style.display = "none";
    document.getElementById("registerSection").style.display = "none";

    loadPets();
}

/*===============================
    MASCOTAS
================================*/
function openNewPetModal() {
    new bootstrap.Modal(document.getElementById("newPetModal")).show();
}

function savePet() {
    let name = document.getElementById("petName").value;
    let type = document.getElementById("petType").value;

    let users = loadUsers();
    users[currentUser].pets.push({
        name,
        type,
        history: []
    });
    saveUsers(users);

    loadPets();
    alert("Mascota guardada");

    bootstrap.Modal.getInstance(document.getElementById("newPetModal")).hide();
}

function loadPets() {
    let users = loadUsers();
    let pets = users[currentUser].pets;
    let container = document.getElementById("petList");

    container.innerHTML = "";

    pets.forEach((p, i) => {
        container.innerHTML += `
            <div class="card p-3 my-2">
                <h4>${p.name}</h4>
                <small>${p.type}</small>
                <button class="btn btn-primary mt-2" onclick="openPetInfo(${i})">
                    Ver Detalles
                </button>
            </div>
        `;
    });
}

/*===============================
    INFO DE MASCOTA
================================*/
function openPetInfo(index) {
    selectedPetIndex = index;

    let users = loadUsers();
    let pet = users[currentUser].pets[index];

    document.getElementById("petInfoTitle").textContent = pet.name;
    document.getElementById("petInfoType").textContent = pet.type;

    let list = document.getElementById("petHistory");
    list.innerHTML = pet.history.map(h => `<li class='list-group-item'>${h}</li>`).join("");

    new bootstrap.Modal(document.getElementById("petInfoModal")).show();
}

function addHistory() {
    let note = document.getElementById("newHistory").value;

    if(note.trim() === "") return;

    let users = loadUsers();
    users[currentUser].pets[selectedPetIndex].history.push(note);

    saveUsers(users);
    openPetInfo(selectedPetIndex);

    document.getElementById("newHistory").value = "";
}

/*===============================
    AGENDAR
================================*/
function schedule(type) {
    let users = loadUsers();
    let pet = users[currentUser].pets[selectedPetIndex];

    let fecha = prompt("Ingresa fecha para la " + type + " (dd/mm/aaaa):");

    if (fecha) {
        pet.history.push("Agendado: " + type + " para el " + fecha);
        saveUsers(users);
        openPetInfo(selectedPetIndex);
        alert("Cita registrada");
    }
}
</script>

</body>
</html>
